<html>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script>
var data = {
	"title" : "BackgroundSubtraction.pde",
	"results": [{
		"img_url": "http://farm4.staticflickr.com/3680/9220555920_12b1562f65.jpg",
		"code" : "import processing.video.*;\n\nMovie video;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {\n  image(video, 0, 0);  \n}\n\nvoid movieEvent(Movie m) {\n  m.read();\n}",
		"comments" : ["Just the standard play-a-movie sketch."]
		},
		{
		"img_url" : "http://farm6.staticflickr.com/5480/9220555484_d2192060fb.jpg",
		"code" : "import processing.video.*;\nimport gab.opencvpro.*;\n\nMovie video;\nOpenCV opencv;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n  opencv = new OpenCV(this, 720, 480);\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {\n  opencv.loadImage(video);\n  image(opencv.getOutput(), 0, 0);\n}\n\nvoid movieEvent(Movie m) {\n  m.read();\n}",
		"comments" : ["Load each frame into OpenCV. And display the OpenCV output image."]
		},
		{
		"img_url" : "http://farm3.staticflickr.com/2806/9220555200_2b69b12cff.jpg",
		"code" : "import processing.video.*;\nimport gab.opencvpro.*;\n\nMovie video;\nOpenCV opencv;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n  opencv = new OpenCV(this, 720, 480);\n\n  opencv.startBackgroundSubtraction(5, 3, 0.5);\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {\n  opencv.loadImage(video);\n  opencv.updateBackground();\n  image(opencv.getOutput(), 0, 0);\n}",
		"comments" : ["Initialize background subtraction.", 
					  "First argument is how much history to track.", 
					  "Second argument is.", 
					  "Third argument is.",
					  "Update the background. This stores the result into the gray image to be displayed."]
		},
		{
		"img_url" : "http://farm3.staticflickr.com/2879/9217782347_f923ca7273.jpg",
		"code" : "import processing.video.*;\nimport gab.opencvpro.*;\n\nMovie video;\nOpenCV opencv;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n  opencv = new OpenCV(this, 720, 480);\n\n  opencv.startBackgroundSubtraction(5, 3, 0.5);\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {  \n  opencv.loadImage(video);\n  opencv.updateBackground();\n\n  image(video, 0, 0);\n  \n  noFill();\n  stroke(255,0,0);\n  strokeWeight(2);\n  for(Contour contour : opencv.findContours()){\n    contour.draw();\n  }\n}\n\nvoid movieEvent(Movie m) {\n  m.read();\n}\n",
		"comments" : ["Find contours based on the subtracted background.",
					  "Draw the contours."]
		},
		{
		"img_url" : "http://farm8.staticflickr.com/7304/9217782161_88947c057d.jpg",
		"code" : "import processing.video.*;\nimport gab.opencvpro.*;\n\nMovie video;\nOpenCV opencv;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n  opencv = new OpenCV(this, 720, 480);\n\n  opencv.startBackgroundSubtraction(5, 3, 0.5);\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {  \n  opencv.loadImage(video);\n  opencv.updateBackground();\n  \n  opencv.dilate();\n  opencv.erode();\n\n  image(video, 0, 0);\n  \n  noFill();\n  stroke(255,0,0);\n  strokeWeight(2);\n  for(Contour contour : opencv.findContours()){\n    contour.draw();\n  }  \n}\n\nvoid movieEvent(Movie m) {\n  m.read();\n}\n",
		"comments" : ["Dilate and erode in order to close holes in the contours"]
		},
		{
		"img_url" : "http://farm6.staticflickr.com/5330/9217781749_5ed9986f62.jpg",
		"code" : "import processing.video.*;\nimport gab.opencvpro.*;\nimport java.awt.Rectangle;\n\nMovie video;\nOpenCV opencv;\n\nvoid setup() {\n  size(720, 480, P2D);\n  video = new Movie(this, \"street.mov\");\n  opencv = new OpenCV(this, 720, 480);\n\n  opencv.startBackgroundSubtraction(5, 3, 0.5);\n\n  video.loop();\n  video.play();\n}\n\nvoid draw() {  \n  opencv.loadImage(video);\n  opencv.updateBackground();\n  \n  opencv.dilate();\n  opencv.erode();\n\n  image(video, 0, 0);\n  \n  noFill();\n  stroke(255,0,0);\n  strokeWeight(2);\n  for(Contour contour : opencv.findContours()){\n    Rectangle r = contour.getBoundingBox();\n    rect(r.x, r.y, r.width, r.height);\n  }    \n}\n\nvoid movieEvent(Movie m) {\n  m.read();\n}\n",
		"comments" : ["Draw the contour bounding box instead of the contour itself.",
					  "If we had a way of merging multiple contours these could be really useful."]
		}

		]

}

$(window).load(function () {

	$("#widgetTitle h3").html(data.title);
	var imgDiv = $("<div>");
	imgDiv.attr("id", "widgetImage");
	imgDiv.append("<img>");

	var codeDiv = $("<div>");
	codeDiv.attr("id", "codeZone");

	var scriptTag = $("<pre>");
	codeDiv.append(scriptTag);

	var commentsDiv = $("<div>");
	commentsDiv.attr("id", "codeComments");
	var commentsList = $("<ul>");
	
	commentsDiv.append(commentsList);

	$("#widgetBody").prepend(commentsDiv);
	$("#widgetBody").prepend(codeDiv);
	$("#widgetBody").prepend(imgDiv);

	var currentVersion = 0;
	var numVersions = data.results.length;

	var updateProgress = function(){
		$("#progress").html((currentVersion+1) + "/" + numVersions);
	};

	var updateLinks = function(){
		$("#next").show();
		$("#previous").show();

		if(currentVersion >= (numVersions - 1)){
			$("#next").hide();
		}

		if(currentVersion === 0){
			$("#previous").hide();
		}

		updateProgress();
	};

	var updateBody = function(){
		$("#widgetImage img").attr("src", data.results[currentVersion].img_url);
		$("#widgetBody pre").html(data.results[currentVersion].code);
			
		$("#codeComments ul").empty();
		for(var i = 0; i < data.results[currentVersion].comments.length; i++){
			var comment = $("<li>")
			comment.html(data.results[currentVersion].comments[i]);
			commentsList.append(comment);
		}
	}

	updateProgress();
	updateLinks();
	updateBody();

	$("#next").click(function(){
		currentVersion = currentVersion + 1;
		updateLinks();
		updateBody();
		return false;
	});

	$("#previous").click(function(){
		currentVersion = currentVersion - 1;
		updateLinks();
		updateBody();
		return false;
	});
});
</script>
<style>
	#widget {
		width: 1300px;
	}

	#widgetBody{
		border: 3px solid #000;
	}

	#widgetBody div {
		width: 400px;
		float: left;
		padding:15px;
	}

	#codeZone {
		border-left: 1px solid #ccc;
		border-right: 1px solid #ccc;
	}

	#widgetBody img {
		/*width: 350px;*/
		/*padding: 25px;*/
		padding: 0;
		margin: 0;
		width: 100%;
	}

	.navButton {
		float:left;
		padding: 3px;
		padding-right: 50px;
		background-color: #000;
		margin-right: 10px;
		color: #fff;
	}

	#progress {
		padding: 3px;
		background-color: #fff;
		color: #000;
		margin-right: 10px;
		float: left;
	}

	#widgetControls a {
		color: #fff;
		font-weight: bold;
		text-decoration: none;
	}

	#widgetTitle {
		float: right;
		text-align: right;

	}

	#widgetTitle h3{
		margin: 0;
		padding: 0;
	}
</style>
<head>
</head>
<body>
	<div id="widget">
		<div id="widgetTitle"><h3>Title</hr></div>

		<div id="widgetControls">
			<div id="progress"></div>
			<div class="navButton" id="previous"><a href="#">Previous</a></div>
			<div class="navButton" id="next"><a href="#">Next</a></div>
		</div>

		<br style="clear:both" />
		<div id="widgetBody">
			<br style="clear:both;"/>
		</div>
	</div>
</body>
</html>