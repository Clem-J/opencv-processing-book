<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script>
var data = {"title":"FaceTracking.pde","results":[{"code":"import gab.opencvpro.*;\nimport processing.video.*;\nimport java.awt.*;\n\nCapture video;\nOpenCV opencv;\n\nvoid setup() {\n  size(640, 480, P2D);\n  video = new Capture(this, 640, 480);\n  opencv = new OpenCV(this, video.width, video.height);\n  opencv.loadCascade(OpenCV.CASCADE_FRONTALFACE_ALT);  \n\n  video.start();\n}\n\nvoid draw() {\n  image(video, 0, 0 );\n\n  opencv.loadImage(video);\n\n  noFill();\n  stroke(0, 255, 0);\n  Rectangle[] faces = opencv.detect();\n  println(faces.length);\n\n  for (int i = 0; i < faces.length; i++) {\n    if (faces[0].width * faces[0].height > 400) {\n      rect(faces[i].x, faces[i].y, faces[i].width, faces[i].height);\n    }\n  }\n}\n\nvoid captureEvent(Capture c) {\n  c.read();\n}\n","illustration_embed":"<a href=\"http://www.flickr.com/photos/unavoidablegrain/9240149505/\" title=\"face detection by atduskgreg, on Flickr\"><img src=\"http://farm6.staticflickr.com/5324/9240149505_58c95f454d.jpg\" width=\"500\" height=\"409\" alt=\"face detection\"></a>","comments":["Initialize Capture and OpenCV objects in the usual way.","Load the cascade file for frontal face detection.","Load the image from the camera into OpenCV.","Detect faces, which returns an array of Java Rectangle objects.","Loop through the array and draw each face rectangle."]},{"code":"import gab.opencvpro.*;\nimport processing.video.*;\nimport java.awt.*;\n\nCapture video;\nOpenCV opencv;\n\nvoid setup() {\n  size(640, 480, P2D);\n  video = new Capture(this, 640, 480);\n  opencv = new OpenCV(this, video.width, video.height);\n  opencv.loadCascade(OpenCV.CASCADE_RIGHT_EAR);  \n\n  video.start();\n}\n\nvoid draw() {\n  image(video, 0, 0 );\n\n  opencv.loadImage(video);\n\n  noFill();\n  stroke(0, 255, 0);\n  Rectangle[] faces = opencv.detect();\n  println(faces.length);\n\n  for (int i = 0; i < faces.length; i++) {\n    if (faces[0].width * faces[0].height > 400) {\n      rect(faces[i].x, faces[i].y, faces[i].width, faces[i].height);\n    }\n  }\n}\n\nvoid captureEvent(Capture c) {\n  c.read();\n}\n","illustration_embed":"<a href=\"http://www.flickr.com/photos/unavoidablegrain/9242930412/\" title=\"Ear detection by atduskgreg, on Flickr\"><img src=\"http://farm3.staticflickr.com/2821/9242930412_19885a78d5.jpg\" width=\"500\" height=\"409\" alt=\"Ear detection\"></a>","comments":["Now, load a cascade file for the right ear.","Detect the ears.","Draw them as before.","Note: Since the video input is mirrored, this detects my left ear, not my right ear."]},{"code":"import gab.opencvpro.*;\nimport processing.video.*;\nimport java.awt.*;\n\nCapture video;\nOpenCV opencv;\n\nPImage small;\nint scaleFactor = 4;\n\nvoid setup() {\n  size(640, 480, P2D);\n  video = new Capture(this, 640, 480);\n  opencv = new OpenCV(this, video.width/scaleFactor, video.height/scaleFactor);\n  opencv.loadCascade(OpenCV.CASCADE_FRONTALFACE_ALT);  \n\n  small = createImage(opencv.width, opencv.height, ARGB);\n\n  video.start();\n}\n\nvoid draw() {\n  image(video, 0, 0 );\n\n  small.copy(video, 0, 0, video.width, video.height, 0, 0, small.width, small.height);\n  opencv.loadImage(small);\n\n  pushMatrix();\n  noFill();\n  scale(scaleFactor);\n  stroke(0, 255, 0);\n  Rectangle[] faces = opencv.detect();\n  println(faces.length);\n\n  for (int i = 0; i < faces.length; i++) {\n    if (faces[0].width * faces[0].height > 400) {\n      rect(faces[i].x, faces[i].y, faces[i].width, faces[i].height);\n    }\n  }\n\n  popMatrix();\n}\n\nvoid captureEvent(Capture c) {\n  c.read();\n}\n","illustration_embed":"<a href=\"http://www.flickr.com/photos/unavoidablegrain/9242930178/\" title=\"Face detection by atduskgreg, on Flickr\"><img src=\"http://farm8.staticflickr.com/7399/9242930178_104b90b065.jpg\" width=\"500\" height=\"409\" alt=\"Face detection\"></a>","comments":["This iterations, speeds up detection, by running on a smaller version of the input image. We won't be able to detect really small faces, but it will run faster.","Declare a PImage to store our resized image and set our scaling factor.","Initialize our OpenCV object at the smaller scale.","Populate our PImage variable with a new PImage at the right size.","Copy the pixels from the video into the small PImage. Giving it the smaller width and height as dimensions will scale the image down.","Load this smaller image into OpenCV for processing","Scale up our drawing inversely to our scaled-down image so the results will match the size of the video.","Draw the faces as usual."]}]};

$(window).load(function () {

	$("#widgetTitle h3").html(data.title);
	var imgDiv = $("<div>");
	imgDiv.attr("id", "widgetImage");
	imgDiv.attr("class", "span4");
	// imgDiv.append("<img>");

	var codeDiv = $("<div>");
	codeDiv.attr("id", "codeZone");
	codeDiv.attr("class", "span5");

	var scriptTag = $("<pre>");
	codeDiv.append(scriptTag);

	var commentsDiv = $("<div>");
	commentsDiv.attr("id", "codeComments");
	commentsDiv.attr("class", "span3");
	var commentsList = $("<ul>");
	
	commentsDiv.append(commentsList);

	$("#widgetBody").prepend(commentsDiv);
	$("#widgetBody").prepend(codeDiv);
	$("#widgetBody").prepend(imgDiv);

	var currentVersion = 0;
	var numVersions = data.results.length;

	var updateProgress = function(){
		$("#progress").html((currentVersion+1) + "/" + numVersions);
	};

	var updateLinks = function(){
		$("#next").show();
		$("#previous").show();

		if(currentVersion >= (numVersions - 1)){
			$("#next").hide();
		}

		if(currentVersion === 0){
			$("#previous").hide();
		}

		updateProgress();
	};

	var updateBody = function(){
		$("#widgetImage").html(data.results[currentVersion].illustration_embed);
		$("#widgetBody pre").html(data.results[currentVersion].code);
			
		$("#codeComments ul").empty();
		for(var i = 0; i < data.results[currentVersion].comments.length; i++){
			var comment = $("<li>")
			comment.html(data.results[currentVersion].comments[i]);
			commentsList.append(comment);
		}
	}

	updateProgress();
	updateLinks();
	updateBody();

	$("#next").click(function(){
		currentVersion = currentVersion + 1;
		updateLinks();
		updateBody();
		return false;
	});

	$("#previous").click(function(){
		currentVersion = currentVersion - 1;
		updateLinks();
		updateBody();
		return false;
	});
});
</script>

<script>
$(function ()  
{ $(".pop").popover({placement: 'bottom'});  
});  
</script>

<script src="js/bootstrap.min.js"></script>

<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/styles.css" rel="stylesheet" type="text/css" />

</head>
<body>
	<h1 id="trackallthethings">Track All the Things</h1>

<h2 id="facedetection">Face Detection</h2>

<p><em>Detecting faces in images is one of the most ubiquitous applications of computer vision. We see it in our digital cameras for autofocus, on our social networks to identify our friends, in public surveillance systems, and many other places. In this project, we&#8217;ll learn how to detect faces using OpenCV. We&#8217;ll see a little bit about how the face detection process works, how it can fail, and how we can apply it to detect other things besides just faces.</em></p>

<p><iframe src="http://player.vimeo.com/video/69907695" width="1000" height="562" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<p><em>Video and images from Adam Harvey&#8217;s <a href="http://cvdazzle.com">CV Dazzle</a> used with permission. Clock photo by <a href="http://www.flickr.com/photos/jaqian/7292320/">jaqian</a> and pedestrian photo by <a href="http://www.flickr.com/photos/gandalfcunningham/2527870434/">gandalphcunningham</a>.</em></p>

<h3 id="videosummary">Video Summary</h3>

<ul>
<li>Face detection in OpenCV is easy to use.</li>
<li>It is necessary to learn about how it is implemented in order to use it effectively and understand its limitations.</li>
<li>OpenCV&#8217;s face detector uses the Viola-Jones algorithm, originally introduced in the 2001 paper <a href="http://www.merl.com/papers/docs/TR2004-043.pdf">Rapid Object Detection Using a Boosted
Cascade of Simple Features</a>.</li>
<li>Viola-Jones works by matching a defined series of patterns of light and dark rectangles to different areas of the image at different scales.</li>
<li>Faces have a consistent arrangement of highlights and shadows based on how light falls on the facial features.</li>
<li>Viola-Jones can be trained to recognize these patterns.</li>
<li>The training process requires a large set of input images and takes a long time and a lot of computing resources.</li>
<li>The training process produces a &#8220;cascade&#8221; file (usually stored as XML), which can be loaded into OpenCV for realtime detection.</li>
<li>The most commonly used cascade is for frontal faces.</li>
<li>Artist Adam Harvey&#8217;s <a href="http://cvdazzle.com">CV Dazzle</a> project consists of makeup designed to camouflage the wearer from Viola-Jones face detection.</li>
<li>CV Dazzle works by introducing dark and light patches onto the face where the Viola-Jones frontal face cascade does not expect them to be.</li>
<li>Harvey produced <a href="https://vimeo.com/34545827">visualizations</a> that illustrate how the Viola-Jones detection process works.</li>
<li>For more about CV Dazzle and how the Viola-Jones algorithm works, see <a href="http://makematics.com/research/viola-jones/">this Makematics interview with Adam Harvey</a>.</li>
<li>Viola-Jones can detect multiple faces.</li>
<li>Find more faces will slow down the processing of each image.</li>
<li>Viola-Jones can also be used to detect other objects than faces.</li>
<li>Researchers have created cascades for noses, ears, pedestrians, clock faces, and many other objects.</li>
</ul>

<h3 id="thepoliticsoffacedetection">The Politics of Face Detection</h3>

<p>Face detection brings out strong, sometimes contradictory, reactions in people. It triggers our fear of being observed, of surveillance by governments, corporations, and others figures of authority. In response to these fears, there&#8217;s something of a tradition of creative projects that produce inventive ways of avoiding face detection.</p>

<p>Beyond Adam Harvey&#8217;s CV Dazzle, demonstrated above, artists <a href="http://kylemcdonald.net">Kyle McDonald</a> and <a href="http://datenform.de/">Aram Bartholl</a> of the <a href="http://fffff.at/">F.A.T Lab collective</a> created a video on &#8220;<a href="http://fffff.at/how-to-avoid-facial-recognition/">How To Avoid Facial Recognition</a>&#8221;</p>

<p><iframe src="http://player.vimeo.com/video/41861212" width="500" height="281" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe> </p>

<p>Very different in style and tone from CV Dazzle, the combination of humor and punk rock attitude in this video simultaneously expresses and mocks the idea of face detection as a form of technological oppression. </p>

<p>At the end of the video McDonald and Bartholl demonstrate that most face detection systems fail if the face is tilted by more than 15 degrees or so. This is a practical concern when using OpenCV&#8217;s face detection functions. It can be overcome by rotating the image before processing, but that technique is computationally expensive and rarely done.</p>

<p>In addition to the fear of being observed by face detection systems, there&#8217;s a different kind of fear in being invisible to them.</p>

<p>In 2009, two employees of a computer store uploaded a video called <a href="http://www.youtube.com/watch?v=t4DT3tQqgRM">HP Computers are Racist</a> in which they demonstrated an HP MediaSmart computer failing to track the face of a black man, but succeeding on a white woman.</p>

<p><iframe width="420" height="315" src="//www.youtube.com/embed/t4DT3tQqgRM" frameborder="0" allowfullscreen></iframe></p>

<p><a href="http://www.pcmag.com/article2/0,2817,2357429,00.asp">HP responded</a> to the video by explaining the technical roots of the problem and insisting it wasn&#8217;t intentional:</p>

<blockquote>
<p>&#8220;The technology we use is built on standard algorithms that measure the difference in intensity of contrast between the eyes and the upper cheek and nose. We believe that the camera might have difficulty &#8216;seeing&#8217; contrast in conditions where there is insufficient foreground lighting.&#8221;</p>
</blockquote>

<h3 id="quiz">Quiz</h3>

<p>Q: Which of the following conditions will not make OpenCV face detection run faster: A) A smaller input image. B) Fewer faces present in the image. C) Good lighting.
<p class="pop btn" href="#" rel="popover" title="Answer"
data-content="C, good lighting.">Reveal the Answer</p></p>

<p>Q: Is it easier to detect objects with a cascade or to train a new cascade?
<p class="pop btn" href="#" rel="popover" title="Answer"
data-content="Detect. Training is difficult and computationally expensive.">Reveal the Answer</p></p>

<p>Q: What is the minimum angle of orientation that will cause the frontal face cascade to fail to detect the face?
<p class="pop btn" href="#" rel="popover" title="Answer"
data-content="15 degrees.">Reveal the Answer</p></p>

<h3 id="code">Code</h3>

<h4 id="importantfunctions">Important Functions</h4>

<ul>
<li><code>opencv.loadCascade()</code> - Setup for face tracking (or other cascade-based tracking).</li>
<li><code>OpenCV.CASCADE_FRONTALFACE_ALT</code> - A constant referring to the standard cascade for detecting faces. Pass this to <code>opencv.loadCascade()</code> to setup for face detection.</li>
<li><code>opencv.detect()</code> - Detect objects in the current image based on the configured cascade. Returns an array of Rectangle objects.</li>
</ul>

<h4 id="browsethecode">Browse the Code</h4>

<ul>
<li>Detect faces in video</li>
<li>Scaling trick to do it faster</li>
<li>Detect clocks with a different cascade</li>
</ul>
	<div id="container" class="row-fluid">


		<div class="span8 offset2">
			<!--INSERT CONTENT HERE-->
		</div>
	</div>

	<div id="widget">
		<div id="widgetTitle"><h3>Title</h3></div>

		<div id="widgetControls">
			<div id="progress"></div>
			<div class="navButton btn" id="previous"><a href="#">Previous</a></div>
			<div class="navButton btn" id="next"><a href="#">Next</a></div>
		</div>

		<br style="clear:both" />
		<div id="widgetBody" class="row">
			<br style="clear:both;"/>
		</div>
	</div>
</body>
</html>